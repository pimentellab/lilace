<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to Lilace • lilace</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Lilace">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lilace</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction to Lilace</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jermoef/lilace/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to Lilace</h1>
                        <h4 data-toc-skip class="author">Jerome
Freudenberg</h4>
            
            <h4 data-toc-skip class="date">June 28 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jermoef/lilace/blob/HEAD/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Lilace is a tool for scoring FACS-based DMS experiments with
uncertainty quantification. It takes in a negative control group
(usually synonymous variants) and scores each variant relative to the
negative control group.</p>
<p>The standard workflow is:</p>
<ol style="list-style-type: decimal">
<li>Import data into Lilace format</li>
<li>Normalize to cell sorting percentages (if available)</li>
<li>Run Lilace. On a full length protein, Lilace usually takes a few
hours to run (see paper supplement for more details)</li>
<li>Analyze Lilace output</li>
</ol>
<p>This notebook shows an example run of Lilace from installation to
analysis on a toy dataset. We provide functions to load counts into
Lilace’s input format (step 1), normalize counts to cell sorting
proportions (step 2), run Lilace (step 3), and plot the results (step
4). By default, Lilace incorporates variance in the negative control
scores into effect size uncertainty (standard errors) and makes use of
similar effects at a position to improve estimation. Both of these
behaviors can optionally be turned off when running Lilace.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Lilace is built using <code>stan</code> and interacts with
<code>CmdStan</code> using the package <code>cmdstanr</code>. This
requires C++ compilation. The compiler requirements can be seen at <a href="https://github.com/stan-dev/stan/wiki/Coding-Style-and-Idioms#supported-cpp-versions-and-compilers" class="external-link">stan-dev</a>.
If you run into issues with installation, please ensure your gcc version
is &gt; 5.</p>
<p>First, we install <code>cmdstanr</code>. We recommend running this in
a fresh R session or restarting your current session.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cmdstanr"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://stan-dev.r-universe.dev'</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we use <code>cmdstanr</code> to install <code>CmdStan</code>.
This requires a working C++ toolchain and compiler.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/install_cmdstan.html" class="external-link">install_cmdstan</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># number of cores to use for installation</span></span></code></pre></div>
<p>We can check the <code>CmdStan</code> version to verify correct
installation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/set_cmdstan_path.html" class="external-link">cmdstan_version</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can install Lilace from github.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"pimentellab/lilace"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jermoef/lilace" class="external-link">lilace</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-input-data">Load input data<a class="anchor" aria-label="anchor" href="#load-input-data"></a>
</h2>
<p>Next, we load in the toy dataset, which includes the first 20
positions of a GPR68 screen from (<a href="https://www.cell.com/cell/fulltext/S0092-8674(24)01373-4" class="external-link uri">https://www.cell.com/cell/fulltext/S0092-8674(24)01373-4</a>).
This data is provided with a standard installation of Lilace.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"gpr68_ph55_20pos.RData"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">##   hgvs_exp  hgvs  position wildtype mutation type    c_0   c_1   c_2   c_3 exp  </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2A)_… p.(G…        2 G        A        miss…   118   146   215   260 ph55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2A)_… p.(G…        2 G        A        miss…   146   108   127   284 ph55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2A)_… p.(G…        2 G        A        miss…   144    55   106   134 ph55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2C)_… p.(G…        2 G        C        miss…   148   101   384   507 ph55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2C)_… p.(G…        2 G        C        miss…   203   201   307   616 ph55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2C)_… p.(G…        2 G        C        miss…   236   175   262   547 ph55 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: rep &lt;chr&gt;, n_counts &lt;dbl&gt;, total_counts &lt;dbl&gt;</span></span></span></code></pre>
<p>We then put the data into a Lilace object using the
<code><a href="../reference/lilace_from_counts.html">lilace_from_counts()</a></code> function, which requires:</p>
<ol style="list-style-type: decimal">
<li>variant identifier (e.g. hgvs), ensure this is unique for each
variant</li>
<li>mutation type (e.g. synonymous, missense)–this will be used to
identify the negative controls</li>
<li>residue position</li>
<li>replicate information</li>
<li>the FACS bin counts</li>
<li>any metadata you wish to carry over into the final output.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load from components</span></span>
<span><span class="va">lilace_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_from_counts.html">lilace_from_counts</a></span><span class="op">(</span>variant_id<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">hgvs</span>, mutation_type<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">type</span>, </span>
<span>                      position<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">position</span>, replicate<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">rep</span>, </span>
<span>                      counts<span class="op">=</span><span class="va">dataset</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c_"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                      metadata<span class="op">=</span><span class="va">dataset</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">wildtype</span>, <span class="va">mutation</span>, <span class="va">exp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lilace_obj</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   variant [2]</span></span></span>
<span><span class="co">##   variant wildtype mutation exp   type    position rep     c_0   c_1   c_2   c_3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2A) G        A        ph55  missen…        2 R1      118   146   215   260</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2A) G        A        ph55  missen…        2 R2      146   108   127   284</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2A) G        A        ph55  missen…        2 R3      144    55   106   134</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2C) G        C        ph55  missen…        2 R1      148   101   384   507</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2C) G        C        ph55  missen…        2 R2      203   201   307   616</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2C) G        C        ph55  missen…        2 R3      236   175   262   547</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_counts &lt;dbl&gt;, total_counts &lt;dbl&gt;</span></span></span></code></pre>
<p>We also provide the functions <code><a href="../reference/lilace_from_enrich.html">lilace_from_enrich()</a></code>,
which can load counts from enrich2’s output format, and
<code><a href="../reference/lilace_from_files.html">lilace_from_files()</a></code>, which can load counts from separate
bin and replicate count files, but they may not generalize to all
dataset formats. See the end of this vignette for an example call of
each.</p>
</div>
<div class="section level2">
<h2 id="normalize-to-cell-sorting-proportions">Normalize to cell sorting proportions<a class="anchor" aria-label="anchor" href="#normalize-to-cell-sorting-proportions"></a>
</h2>
<p>FACS gating is often set to contain equal proportions of the overall
cell fluorescence distribution, but differences in bin PCR amplification
can lead to the over and under representation of certain bins in the
read counts. If this is the case, the data can be normalized to the
sorting proportions using the <code><a href="../reference/lilace_sorting_normalize.html">lilace_sorting_normalize()</a></code>
function, which takes in a Lilace object and the proportions to
normalize to.</p>
<div class="float">
<img src="gpr68_ph55_sort.png" style="width:60.0%" alt="Example sort proportions."><div class="figcaption">Example sort proportions.</div>
</div>
<p>In this case the sort proportions don’t add up to 1, but that’s okay,
they are scaled to add up to 1 internally.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># normalize to sorting proportions</span></span>
<span><span class="va">GPR_FACS_trace_percent_55</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2184</span>, <span class="fl">0.1972</span>, <span class="fl">0.1869</span>, <span class="fl">0.1236</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lilace_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_sorting_normalize.html">lilace_sorting_normalize</a></span><span class="op">(</span><span class="va">lilace_obj</span>, <span class="va">GPR_FACS_trace_percent_55</span>, rep_specific<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in lilace_sorting_normalize(lilace_obj, GPR_FACS_trace_percent_55, :</span></span>
<span><span class="co">## Sorting proportions sum up to 0.7261 instead of 1.</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lilace_obj</span><span class="op">$</span><span class="va">normalized_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   variant [2]</span></span></span>
<span><span class="co">##   variant wildtype mutation exp   type    position rep     c_0   c_1   c_2   c_3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2A) G        A        ph55  missen…        2 R1      177   164   199   160</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2A) G        A        ph55  missen…        2 R2      192   131   148   150</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2A) G        A        ph55  missen…        2 R3      199    69    92    86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2C) G        C        ph55  missen…        2 R1      222   113   355   312</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2C) G        C        ph55  missen…        2 R2      267   243   356   324</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2C) G        C        ph55  missen…        2 R3      327   218   227   351</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_counts &lt;dbl&gt;, total_counts &lt;dbl&gt;</span></span></span></code></pre>
<p>If we wish to normalize to replicate-specific sorting proportions, we
can format it like the following. The replicate labels in the list (R1,
R2, R3) should correspond to the labels used in the Lilace input.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># normalize to sorting proportions</span></span>
<span><span class="va">GPR_FACS_trace_percent_55</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2184</span>, <span class="fl">0.1972</span>, <span class="fl">0.1869</span>, <span class="fl">0.1236</span><span class="op">)</span>,</span>
<span>                                  R2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2184</span>, <span class="fl">0.1972</span>, <span class="fl">0.1869</span>, <span class="fl">0.1236</span><span class="op">)</span>,</span>
<span>                                  R3<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2184</span>, <span class="fl">0.1972</span>, <span class="fl">0.1869</span>, <span class="fl">0.1236</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lilace_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_sorting_normalize.html">lilace_sorting_normalize</a></span><span class="op">(</span><span class="va">lilace_obj</span>, <span class="va">GPR_FACS_trace_percent_55</span>, rep_specific<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in lilace_sorting_normalize(lilace_obj, GPR_FACS_trace_percent_55, :</span></span>
<span><span class="co">## Sorting proportions sum up to 0.7261 instead of 1.</span></span>
<span><span class="co">## Warning in lilace_sorting_normalize(lilace_obj, GPR_FACS_trace_percent_55, :</span></span>
<span><span class="co">## Sorting proportions sum up to 0.7261 instead of 1.</span></span>
<span><span class="co">## Warning in lilace_sorting_normalize(lilace_obj, GPR_FACS_trace_percent_55, :</span></span>
<span><span class="co">## Sorting proportions sum up to 0.7261 instead of 1.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lilace_obj</span><span class="op">$</span><span class="va">normalized_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   variant [2]</span></span></span>
<span><span class="co">##   variant wildtype mutation exp   type    position rep     c_0   c_1   c_2   c_3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2A) G        A        ph55  missen…        2 R1      177   164   199   160</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2A) G        A        ph55  missen…        2 R2      192   131   148   150</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2A) G        A        ph55  missen…        2 R3      199    69    92    86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2C) G        C        ph55  missen…        2 R1      222   113   355   312</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2C) G        C        ph55  missen…        2 R2      267   243   356   324</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2C) G        C        ph55  missen…        2 R3      327   218   227   351</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_counts &lt;dbl&gt;, total_counts &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="run-lilace">Run Lilace<a class="anchor" aria-label="anchor" href="#run-lilace"></a>
</h2>
<p>Once, we are ready to run Lilace, we first specify an output
directory where the output and model fitting logs will be saved.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"output"</span></span></code></pre></div>
<p>Then, we use the function <code><a href="../reference/lilace_fit_model.html">lilace_fit_model()</a></code> to run the
main Lilace algorithm. This should only take a few minutes on this
truncated dataset, but usually takes a few hours on a full length
protein.</p>
<p>By default, the negative controls will be identified by variants
labeled as <code>synonymous</code> in the <code>lilace$data$type</code>
column. This can be changed by setting the <code>control_label</code>
argument to a different value in the column. To disable the negative
control-based bias correction, set <code>control_correction</code> to
<code>FALSE</code>. To disable position-level grouping, set
<code>use_positions</code> to <code>FALSE</code>. We provide example
outputs for both of these options towards the end of the vignette.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lilace_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_fit_model.html">lilace_fit_model</a></span><span class="op">(</span><span class="va">lilace_obj</span>, <span class="va">output_dir</span>, control_label<span class="op">=</span><span class="st">"synonymous"</span>, </span>
<span>                               control_correction<span class="op">=</span><span class="cn">T</span>, use_positions<span class="op">=</span><span class="cn">T</span>, pseudocount<span class="op">=</span><span class="cn">T</span>,</span>
<span>                               n_parallel_chains<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 finished in 90.4 seconds.</span></span>
<span><span class="co">## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 92.5 seconds.</span></span>
<span><span class="co">## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 finished in 92.9 seconds.</span></span>
<span><span class="co">## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 finished in 132.8 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 102.2 seconds.</span></span>
<span><span class="co">## Total execution time: 132.9 seconds.</span></span></code></pre>
<p>Once it’s done running, Lilace saves the scores for each variant to
<code>output/lilace_output/variant_scores.tsv</code>. The scores
dataframe is also saved in <code>lilace_obj$scores</code>. The scores
are also combined with the input dataframe at
<code>lilace_obj$fitted_data</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"output/lilace_output/variant_scores.tsv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">##   variant        type  wildtype mutation exp   position  effect effect_se   lfsr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2del)      dele… G        del0     ph55         2 -<span style="color: #BB0000;">0.069</span><span style="color: #BB0000; text-decoration: underline;">8</span>     0.283 0.370 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2_N3del)   dele… G        del1     ph55         2  0.345      0.280 0.095<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2_I4del)   dele… G        del2     ph55         2  0.222      0.278 0.214 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2_N3insG)  inse… G        ins0     ph55         2  0.273      0.278 0.159 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2_N3insGS) inse… G        ins1     ph55         2  0.098<span style="text-decoration: underline;">9</span>     0.273 0.366 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2A)        miss… G        A        ph55         2  0.111      0.282 0.356 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: pos_mean &lt;dbl&gt;, pos_sd &lt;dbl&gt;, discovery05 &lt;dbl&gt;</span></span></span></code></pre>
<p>The <code>effect</code> column represents the estimated effect size /
score for a variant, while <code>effect_se</code> gives the standard
error. <code>lfsr</code> is the local false sign rate, which is a
Bayesian measure of significance analogous to a p-value. For example, a
default way to call discoveries would be to set a threshold of
<code>lfsr &lt; 0.05</code>. We encode this in the
<code>discovery05</code> column where a <code>-1</code> indicates a
significant leftward shift in fluorescence, <code>+1</code> a
significant rightward shift, and <code>0</code> is not significant.
<code>pos_mean</code> and <code>pos_sd</code> are the estimated
position-level mean and variance parameters–these parameters are only
included in the final score table if Lilace was run with
<code>use_positions=T</code>.</p>
</div>
<div class="section level2">
<h2 id="plot-results">Plot results<a class="anchor" aria-label="anchor" href="#plot-results"></a>
</h2>
<p>To analyze the output of the model, we can first plot the score
distributions of the different mutation types using
<code><a href="../reference/lilace_score_density.html">lilace_score_density()</a></code> and ensure they align with
expectations.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_density.html">lilace_score_density</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"effect"</span>, </span>
<span>                     name<span class="op">=</span><span class="st">"score_histogram"</span>, hist<span class="op">=</span><span class="cn">T</span>, scale.free<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We observe a substantial LOF mode for indels, a smaller one for
missense mutations, and a distribution around zero for synonymous
mutations.</p>
<p>Next, we plot the estimated scores on a heatmap.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"effect"</span>, name<span class="op">=</span><span class="st">"score_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>As well as the discoveries, at a threshold of
<code>lfsr &lt; 0.05</code>. Again, -1 indicates a significant leftward
shift in fluorescence, +1 a rightward shift, and 0 is not
significant.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"discovery05"</span>, name<span class="op">=</span><span class="st">"discovery05_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>From here on, further analysis can be done, such as mapping to
protein structure and qualitatively analyzing the results.</p>
</div>
<div class="section level2">
<h2 id="example-runs-without-negative-control-correction-or-position-hierarchy">Example runs without negative control correction or position
hierarchy<a class="anchor" aria-label="anchor" href="#example-runs-without-negative-control-correction-or-position-hierarchy"></a>
</h2>
<div class="section level4">
<h4 id="without-the-negative-control-based-bias-correction">Without the negative control-based bias correction<a class="anchor" aria-label="anchor" href="#without-the-negative-control-based-bias-correction"></a>
</h4>
<p>Without the negative control-based bias correction, the effect size
standard errors are smaller and more effects are called significant (at
the cost of more false positives). You may want to run this in cases
where variance in negative controls do not provide a good estimate of
experimental uncertainty (e.g. only a single WT variant), but you still
want Lilace scores for each variant. In this case, Lilace uncertainty
estimates (effect standard errors) do not incorporate any notion of
negative control variance, which may result in more false positives.
(note: a control label column is still required as a reference set to
score against)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify outpur dir</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"output_no_nc_correction"</span></span>
<span><span class="co"># run the model on data</span></span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_fit_model.html">lilace_fit_model</a></span><span class="op">(</span><span class="va">lilace_obj</span>, <span class="va">output_dir</span>, control_label<span class="op">=</span><span class="st">"synonymous"</span>, </span>
<span>                                control_correction<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 finished in 90.1 seconds.</span></span>
<span><span class="co">## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 finished in 91.8 seconds.</span></span>
<span><span class="co">## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 93.3 seconds.</span></span>
<span><span class="co">## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 finished in 132.6 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 102.0 seconds.</span></span>
<span><span class="co">## Total execution time: 132.8 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read scores file</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"output_no_nc_correction/lilace_output/variant_scores.tsv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">##   variant       type  wildtype mutation exp   position  effect effect_se    lfsr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2del)     dele… G        del0     ph55         2 -<span style="color: #BB0000;">0.063</span><span style="color: #BB0000; text-decoration: underline;">8</span>     0.125 0.307  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2_N3del)  dele… G        del1     ph55         2  0.358      0.126 0.002<span style="text-decoration: underline;">5</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2_I4del)  dele… G        del2     ph55         2  0.226      0.107 0.016<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2_N3insG) inse… G        ins0     ph55         2  0.282      0.112 0.006<span style="text-decoration: underline;">75</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2_N3insG… inse… G        ins1     ph55         2  0.106      0.103 0.152  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2A)       miss… G        A        ph55         2  0.110      0.119 0.174  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: pos_mean &lt;dbl&gt;, pos_sd &lt;dbl&gt;, discovery05 &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"effect"</span>, name<span class="op">=</span><span class="st">"score_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"discovery05"</span>, name<span class="op">=</span><span class="st">"discovery05_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-16-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="without-the-position-hierarchy">Without the position hierarchy<a class="anchor" aria-label="anchor" href="#without-the-position-hierarchy"></a>
</h4>
<p>Without using position effects to inform variant effect estimates,
each effect size will be completely independent of the others at its
position. You may want to run this if the data has more than a single
residue mutation at a time or complete position independence is desired
for downstream analysis (e.g. clinical classification that uses multiple
effects at a position as a line of evidence).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify outpur dir</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"output_nopos"</span></span>
<span><span class="co"># run the model on data</span></span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_fit_model.html">lilace_fit_model</a></span><span class="op">(</span><span class="va">lilace_obj</span>, <span class="va">output_dir</span>, control_label<span class="op">=</span><span class="st">"synonymous"</span>, </span>
<span>                                use_positions<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  250 / 2000 [ 12%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  750 / 2000 [ 37%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1250 / 2000 [ 62%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1750 / 2000 [ 87%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 3 finished in 92.0 seconds.</span></span>
<span><span class="co">## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 4 finished in 92.6 seconds.</span></span>
<span><span class="co">## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 2 finished in 93.5 seconds.</span></span>
<span><span class="co">## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 94.1 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 93.1 seconds.</span></span>
<span><span class="co">## Total execution time: 94.1 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read scores file</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"output_nopos/lilace_output/variant_scores.tsv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##   variant        type  wildtype mutation exp   position  effect effect_se   lfsr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2del)      dele… G        del0     ph55         2 -<span style="color: #BB0000;">0.187</span>      0.290 0.235 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2_N3del)   dele… G        del1     ph55         2  0.452      0.298 0.054<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2_I4del)   dele… G        del2     ph55         2  0.245      0.293 0.195 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2_N3insG)  inse… G        ins0     ph55         2  0.328      0.283 0.108 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2_N3insGS) inse… G        ins1     ph55         2  0.084<span style="text-decoration: underline;">9</span>     0.284 0.394 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2A)        miss… G        A        ph55         2  0.069<span style="text-decoration: underline;">3</span>     0.288 0.424 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: discovery05 &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"effect"</span>, name<span class="op">=</span><span class="st">"score_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lilace_score_heatmap.html">lilace_score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">output_dir</span>, score.col<span class="op">=</span><span class="st">"discovery05"</span>, name<span class="op">=</span><span class="st">"discovery05_heatmap"</span>, </span>
<span>                     x.text<span class="op">=</span><span class="fl">4</span>, seq.text<span class="op">=</span><span class="fl">1.5</span>, y.text<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="view-posterior-samples">View posterior samples<a class="anchor" aria-label="anchor" href="#view-posterior-samples"></a>
</h2>
<p>For convenience and advanced analysis, the posterior samples are
saved in <code>lilace_output/posterior_samples.RData</code>. They can be
analyzed further with the <code>posterior</code> package. Here is an
example of how to access them:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"output/lilace_output/posterior_samples.RData"</span><span class="op">)</span></span>
<span><span class="va">posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_rvars.html" class="external-link">as_draws_rvars</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_of.html" class="external-link">draws_of</a></span><span class="op">(</span><span class="va">posterior_samples</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]       [,2]      [,3]</span></span>
<span><span class="co">## 1 0.0130850 0.01033440 0.0219349</span></span>
<span><span class="co">## 2 0.0118919 0.01305480 0.0219369</span></span>
<span><span class="co">## 3 0.0161553 0.00783614 0.0250009</span></span>
<span><span class="co">## 4 0.0177819 0.00515565 0.0211849</span></span>
<span><span class="co">## 5 0.0206479 0.00637177 0.0244694</span></span>
<span><span class="co">## 6 0.0221742 0.01094440 0.0206382</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="format-input-data-from-enrich2-output-format">Format input data from Enrich2 output format<a class="anchor" aria-label="anchor" href="#format-input-data-from-enrich2-output-format"></a>
</h2>
<p>This function expects data in the following format created through
processing counts with Enrich2. <img src="enrich_format.png" style="width:60.0%" alt="Enrich2 counts example format"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enrich_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"kir21_enrich_format.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span></span>
<span><span class="va">lilace_obj_from_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_from_enrich.html">lilace_from_enrich</a></span><span class="op">(</span><span class="va">enrich_file</span>, pheno<span class="op">=</span><span class="st">"abundance"</span><span class="op">)</span> <span class="co"># filtering to just the abundance phenotype</span></span></code></pre></div>
<pre><code><span><span class="co">## Formatting from enrich2 output. Synonymous mutations will be used for negative control-based bias correction. If this is not desirable, please input using the format_data() function.</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lilace_obj_from_enrich</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   variant [2]</span></span></span>
<span><span class="co">##   variant  position wildtype mutation type     c_0   c_1   c_2   c_3 exp   rep  </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(A22A)       22 A        A        synon…   116   181   176   278 abun… R1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(A22A)       22 A        A        synon…   221   230   420   397 abun… R2   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(A22A)       22 A        A        synon…    94   133   119   257 abun… R4   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(A22A)       22 A        A        synon…   207   210   385   412 abun… R5   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(A22C)       22 A        C        misse…    60   187    96   115 abun… R1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(A22C)       22 A        C        misse…   102   148   104    60 abun… R2   </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_counts &lt;dbl&gt;, total_counts &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="format-input-from-separate-gating-files">Format input from separate gating files<a class="anchor" aria-label="anchor" href="#format-input-from-separate-gating-files"></a>
</h2>
<p>Here, we provide an example of formatting from multiple input files
where the counts for each bin and replicate are in different files (such
as from the Dumpling processing pipeline). The counts will be joined by
shared column names, so each file must have at least a variant id
column, a position column, and a mutation type column. For example the
counts from bin 1 in replicate 1 could look like: <img src="sep_file_counts.png" style="width:60.0%" alt="Separate file counts example format"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># input files in list format </span></span>
<span><span class="co"># (can add more replicates or bins--make sure they are in order from left to right)</span></span>
<span><span class="va">file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R1_A.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 1 bin 1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R1_B.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 1 bin 2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R1_C.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 1 bin 3</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R1_D.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>  <span class="co"># rep 1 bin 4 </span></span>
<span>  <span class="op">)</span>,</span>
<span>                  R2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R2_A.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 2 bin 1 </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R2_B.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 2 bin 2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R2_C.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span>, <span class="co"># rep 2 bin 3</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"multi_input/R2_D.tsv"</span>, package<span class="op">=</span><span class="st">"lilace"</span><span class="op">)</span><span class="op">)</span> <span class="co"># rep 2 bin 4</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">lilace_obj_from_multi_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lilace_from_files.html">lilace_from_files</a></span><span class="op">(</span><span class="va">file_list</span>, </span>
<span>                                                variant_id_col<span class="op">=</span><span class="st">"hgvs"</span>,</span>
<span>                                                position_col<span class="op">=</span><span class="st">"position"</span>,</span>
<span>                                                mutation_type_col<span class="op">=</span><span class="st">"type"</span>,</span>
<span>                                                count_col<span class="op">=</span><span class="st">"count"</span>, <span class="co"># column containing count is called count</span></span>
<span>                                                delim<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lilace_obj_from_multi_file</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   variant [3]</span></span></span>
<span><span class="co">##   variant wildtype mutation type     position rep     c_0   c_1   c_2   c_3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> p.(G2A) G        A        missense        2 R1      118   146   215   260</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> p.(G2A) G        A        missense        2 R2      146   108   127   284</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> p.(G2C) G        C        missense        2 R1      148   101   384   507</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> p.(G2C) G        C        missense        2 R2      203   201   307   616</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> p.(G2D) G        D        missense        2 R1      201   185   212   328</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p.(G2D) G        D        missense        2 R2      176   142   119   343</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_counts &lt;int&gt;, total_counts &lt;int&gt;</span></span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jerome Freudenberg.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
